/*!
 * mediabox
 * v1.1.3 |
 * (c) 2022 Pedro Rogerio |
 * https://github.com/pinceladasdaweb/mediabox
 */
class MediaBox{constructor(e,t=0){return this&&this instanceof MediaBox?!!e&&(this.params=Object.assign({autoplay:"1"},t),this.selector=e instanceof NodeList?[...e]:[...document.querySelectorAll(e)],this.root=document.querySelector("body"),void this.run()):new MediaBox(e,t)}run(){Array.prototype.forEach.call(this.selector,t=>{t.addEventListener("click",e=>{e.preventDefault();e=this.parseUrl(t.getAttribute("href"));this.render(e),this.events()},!1)}),this.root.addEventListener("keyup",e=>{27===(e.keyCode||e.which)&&this.close(this.root.querySelector(".mediabox-wrap"))},!1)}template(e,t){let o;for(o in t)t.hasOwnProperty(o)&&(e=e.replace(new RegExp(`{${o}}`,"g"),t[o]));return e}parseUrl(e){var t,o={};return(t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/))?(o.provider="youtube",o.id=t[2]):(t=e.match(/https?:\/\/(?:www\.)?vimeo.com\/(?:channels\/|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|)(\d+)(?:$|\/|\?)/))?(o.provider="vimeo",o.id=t[3]):(o.provider="Unknown",o.id=""),o}render(e){let t;if("youtube"===e.provider)t="https://www.youtube.com/embed/"+e.id;else{if("vimeo"!==e.provider)throw new Error("Invalid video URL");t="https://player.vimeo.com/video/"+e.id}e=this.serialize(this.params),e=this.template('<div class="mediabox-wrap" role="dialog" aria-hidden="false"><div class="mediabox-content" role="document" tabindex="0"><span id="mediabox-esc" class="mediabox-close" aria-label="close" tabindex="1"></span><iframe src="{embed}{params}" frameborder="0" allowfullscreen></iframe></div></div>',{embed:t,params:e}),this.lastFocusElement=document.activeElement,this.root.insertAdjacentHTML("beforeend",e),document.body.classList.add("stop-scroll")}events(){const t=document.querySelector(".mediabox-wrap"),o=document.querySelector(".mediabox-content");t.addEventListener("click",e=>{(e.target&&"SPAN"===e.target.nodeName&&"mediabox-close"===e.target.className||"DIV"===e.target.nodeName&&"mediabox-wrap"===e.target.className||"mediabox-content"===e.target.className&&"IFRAME"!==e.target.nodeName)&&this.close(t)},!1),document.addEventListener("focus",e=>{o&&!o.contains(e.target)&&(e.stopPropagation(),o.focus())},!0),o.addEventListener("keypress",e=>{13===e.keyCode&&this.close(t)},!1)}close(e){if(null===e)return!0;e.classList.add("mediabox-hide"),setTimeout(()=>{var e=document.querySelector(".mediabox-wrap");null!==e&&(document.body.classList.remove("stop-scroll"),this.root.removeChild(e),this.lastFocusElement.focus())},500)}serialize(o){return"?"+Object.keys(o).reduce((e,t)=>(e.push(t+"="+encodeURIComponent(o[t])),e),[]).join("&")}}export default MediaBox;